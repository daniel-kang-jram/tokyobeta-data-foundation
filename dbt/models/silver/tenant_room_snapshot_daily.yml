version: 2

models:
  - name: tenant_room_snapshot_daily
    description: |
      Daily incremental snapshot of active tenant-room pairs for occupancy tracking.
      
      Grain: One row per (snapshot_date, tenant_id, apartment_id, room_id).
      Materialization: Incremental (append-only by snapshot_date).
      Retention: 12 months in Aurora, older archived to S3.
      
      Volume: ~12,000 rows/day (~4.4M rows/year).
      
      Used by:
      - gold.occupancy_daily_metrics (KPI computation)
      - Analysis queries requiring tenant-level daily history
      
      **DATA QUALITY:**
      - dbt tests disabled (too slow on 1.5M+ rows, taking 5+ minutes)
      - Constraints validated by incremental date gating + downstream sanity checks
      - Verified during backfill and spot-checked via SQL queries
    
    config:
      materialized: incremental
      incremental_strategy: append
    
    columns:
      - name: snapshot_date
        description: Date of snapshot
      
      - name: tenant_id
        description: Tenant ID
      
      - name: apartment_id
        description: Apartment/property ID
      
      - name: room_id
        description: Room ID
      
      - name: management_status_code
        description: Tenant status code (numeric)
      
      - name: management_status
        description: Tenant status (Japanese label)
      
      - name: tenant_name
        description: Tenant full name
      
      - name: property
        description: Apartment/building name
      
      - name: room_number
        description: Room number
      
      - name: contract_category
        description: Contract type category
      
      - name: move_in_date
        description: Move-in date
      
      - name: moveout_date
        description: Planned/scheduled moveout date (forecast)
      
      - name: moveout_plans_date
        description: Actual moveout date (past only)
      
      - name: moving_id
        description: Moving record ID
      
      - name: dbt_updated_at
        description: Timestamp when dbt last updated this row
