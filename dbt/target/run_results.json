{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.19", "generated_at": "2026-02-09T03:41:22.836486Z", "invocation_id": "6f64b545-643a-4a6e-bd06-c6aec9a39735", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-09T03:41:14.483516Z", "completed_at": "2026-02-09T03:41:14.487701Z"}, {"name": "execute", "started_at": "2026-02-09T03:41:14.488152Z", "completed_at": "2026-02-09T03:41:22.700914Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 8.219635009765625, "adapter_response": {"_message": "SUCCESS 3961", "code": "SUCCESS", "rows_affected": 3961}, "message": "SUCCESS 3961", "failures": null, "unique_id": "model.tokyobeta_analytics.daily_activity_summary", "compiled": true, "compiled_code": "\n\n-- Gold Layer: Daily Activity Summary\n-- Aggregates daily property management activities by individual/corporate tenant type\n-- \u30b0\u30e9\u30cb\u30e5\u30e9\u30ea\u30c6\u30a3: Daily\n-- \u30c7\u30fc\u30bf: \u554f\u3044\u5408\u308f\u305b, \u7533\u3057\u8fbc\u307f, \u5951\u7d04\u7de0\u7d50, \u78ba\u5b9a\u5165\u5c45\u8005, \u78ba\u5b9a\u9000\u53bb\u8005, \u7a3c\u50cd\u5ba4\u6570\u5897\u6e1b (by \u500b\u4eba and \u6cd5\u4eba)\n--\n-- METRIC DEFINITIONS (CORRECTED):\n-- 1. inquiries_count (\u554f\u3044\u5408\u308f\u305b\u6570): Number of NEW tenants registered with any status that day\n-- 2. applications_count (\u7533\u3057\u8fbc\u307f\u6570): Tenants with status \u4eee\u4e88\u7d04(4) or \u521d\u671f\u8cc3\u6599(5) where updated_at is that day\n-- 3. contracts_signed_count (\u5951\u7d04\u7de0\u7d50): Contracts signed by contract_date\n-- 4. confirmed_moveins_count (\u78ba\u5b9a\u5165\u5c45\u8005/\u5165\u5c45\u6570): Tenants with status [4,5,6,7,9,14,15] where movein_date is that day\n-- 5. confirmed_moveouts_count (\u78ba\u5b9a\u9000\u53bb\u8005): Tenants with status [14,15,16,17] where moveout_date is that day\n-- 6. net_occupancy_delta (\u7a3c\u50cd\u5ba4\u6570\u5897\u6e1b): Move-ins minus move-outs\n\nWITH inquiries AS (\n    -- \u554f\u3044\u5408\u308f\u305b\u6570: New tenants registered (any status) by creation date\n    SELECT\n        DATE(t.created_at) as activity_date,\n        CASE \n            WHEN t.contract_type IN (2, 3) THEN 'corporate'  -- \u6cd5\u4eba\u5951\u7d04, \u6cd5\u4eba\u5951\u7d04\u500b\u4eba\n            WHEN t.contract_type IN (1, 6, 7, 9) THEN 'individual'  -- \u4e00\u822c, \u5b9a\u671f\u5951\u7d04, \u4e00\u822c\u4fdd\u8a3c\u4eba, \u4e00\u822c2\n            ELSE 'unknown'  -- \u672a\u8a2d\u5b9a, Airbnb\n        END as tenant_type,\n        COUNT(DISTINCT t.id) as inquiry_count\n    FROM `staging`.`tenants` t\n    WHERE t.created_at IS NOT NULL\n      AND t.created_at >= '2018-01-01'\n    GROUP BY DATE(t.created_at), tenant_type\n),\n\napplications AS (\n    -- \u7533\u3057\u8fbc\u307f\u6570: Tenants who transitioned to status \u4eee\u4e88\u7d04(4) or \u521d\u671f\u8cc3\u6599(5)\n    -- Uses tenant_status_history to capture historical status changes (not just current snapshot)\n    SELECT\n        h.valid_from as activity_date,\n        CASE \n            WHEN h.contract_type IN (2, 3) THEN 'corporate'\n            WHEN h.contract_type IN (1, 6, 7, 9) THEN 'individual'\n            ELSE 'unknown'\n        END as tenant_type,\n        COUNT(DISTINCT h.tenant_id) as application_count\n    FROM `silver`.`tenant_status_history` h\n    WHERE h.status IN (4, 5)  -- 4=\u4eee\u4e88\u7d04, 5=\u521d\u671f\u8cc3\u6599\n      AND h.valid_from IS NOT NULL\n      AND h.valid_from >= '2018-01-01'\n    GROUP BY h.valid_from, tenant_type\n),\n\ncontracts_signed AS (\n    -- \u5951\u7d04\u7de0\u7d50: Contracts signed by contract_date (\u5951\u7d04\u7de0\u7d50\u65e5)\n    -- Only includes valid contracts (is_valid_contract = true)\n    SELECT\n        contract_date as activity_date,\n        tenant_type,\n        COUNT(*) as contract_signed_count\n    FROM `silver`.`int_contracts`\n    WHERE contract_date IS NOT NULL\n      AND is_valid_contract\n      AND contract_date >= '2018-01-01'\n    GROUP BY contract_date, tenant_type\n),\n\nconfirmed_movein AS (\n    -- \u78ba\u5b9a\u5165\u5c45\u8005/\u5165\u5c45\u6570: Count move-ins where tenant had eligible status ON the move-in date\n    -- Point-in-time check: tenant's status on that specific date\n    -- Status: \u4eee\u4e88\u7d04(4)\u3001\u521d\u671f\u8cc3\u6599(5)\u3001\u5165\u5c45\u8aac\u660e(6)\u3001\u5165\u5c45(7)\u3001\u5c45\u4f4f\u4e2d(9)\u3001\u9000\u53bb\u901a\u77e5(14)\u3001\u9000\u53bb\u4e88\u5b9a(15)\n    SELECT\n        DATE(mv.movein_date) as activity_date,\n        CASE \n            WHEN h.contract_type IN (2, 3) THEN 'corporate'\n            WHEN h.contract_type IN (1, 6, 7, 9) THEN 'individual'\n            ELSE 'unknown'\n        END as tenant_type,\n        COUNT(DISTINCT mv.tenant_id) as movein_count\n    FROM `staging`.`movings` mv\n    INNER JOIN `silver`.`tenant_status_history` h \n        ON mv.tenant_id = h.tenant_id\n    WHERE mv.movein_date IS NOT NULL\n      AND mv.movein_date >= '2018-01-01'\n      -- Tenant had eligible status ON the move-in date (status period overlaps with that date)\n      AND h.status IN (4, 5, 6, 7, 9, 14, 15)\n      AND h.valid_from <= mv.movein_date \n      AND (h.valid_to IS NULL OR h.valid_to >= mv.movein_date)\n    GROUP BY DATE(mv.movein_date), tenant_type\n),\n\nconfirmed_moveout AS (\n    -- \u78ba\u5b9a\u9000\u53bb\u8005: Count move-outs where tenant had moveout status ON the moveout date\n    -- Point-in-time check: tenant's status on that specific date\n    -- Status: \u9000\u53bb\u901a\u77e5(14)\u3001\u9000\u53bb\u4e88\u5b9a(15)\u3001\u30e1\u30f3\u30c6\u5f85\u3061(16)\u3001\u9000\u53bb\u6e08\u307f(17)\n    SELECT\n        DATE(mv.moveout_date) as activity_date,\n        CASE \n            WHEN h.contract_type IN (2, 3) THEN 'corporate'\n            WHEN h.contract_type IN (1, 6, 7, 9) THEN 'individual'\n            ELSE 'unknown'\n        END as tenant_type,\n        COUNT(DISTINCT mv.tenant_id) as moveout_count\n    FROM `staging`.`movings` mv\n    INNER JOIN `silver`.`tenant_status_history` h \n        ON mv.tenant_id = h.tenant_id\n    WHERE mv.moveout_date IS NOT NULL\n      AND mv.moveout_date >= '2018-01-01'\n      -- Tenant had moveout status ON the moveout date (status period overlaps with that date)\n      AND h.status IN (14, 15, 16, 17)  -- \u9000\u53bb\u901a\u77e5\u3001\u9000\u53bb\u4e88\u5b9a\u3001\u30e1\u30f3\u30c6\u5f85\u3061\u3001\u9000\u53bb\u6e08\u307f\n      AND h.valid_from <= mv.moveout_date\n      AND (h.valid_to IS NULL OR h.valid_to >= mv.moveout_date)\n    GROUP BY DATE(mv.moveout_date), tenant_type\n),\n\n-- Generate all dates in the range\ndate_spine AS (\n    SELECT DISTINCT\n        activity_date,\n        tenant_type\n    FROM (\n        SELECT activity_date, tenant_type FROM inquiries\n        UNION SELECT activity_date, tenant_type FROM applications\n        UNION SELECT activity_date, tenant_type FROM contracts_signed\n        UNION SELECT activity_date, tenant_type FROM confirmed_movein\n        UNION SELECT activity_date, tenant_type FROM confirmed_moveout\n    ) all_dates\n),\n\nfinal AS (\n    SELECT\n        ds.activity_date,\n        ds.tenant_type,\n        COALESCE(inq.inquiry_count, 0) as inquiries_count,            -- \u554f\u3044\u5408\u308f\u305b\n        COALESCE(app.application_count, 0) as applications_count,     -- \u7533\u3057\u8fbc\u307f\n        COALESCE(cs.contract_signed_count, 0) as contracts_signed_count,  -- \u5951\u7d04\u7de0\u7d50\n        COALESCE(mi.movein_count, 0) as confirmed_moveins_count,      -- \u78ba\u5b9a\u5165\u5c45\u8005\n        COALESCE(mo.moveout_count, 0) as confirmed_moveouts_count,    -- \u78ba\u5b9a\u9000\u53bb\u8005\n        COALESCE(mi.movein_count, 0) - COALESCE(mo.moveout_count, 0) as net_occupancy_delta,  -- \u7a3c\u50cd\u5ba4\u6570\u5897\u6e1b\n        CURRENT_TIMESTAMP as created_at,\n        CURRENT_TIMESTAMP as updated_at\n    FROM date_spine ds\n    LEFT JOIN inquiries inq\n        ON ds.activity_date = inq.activity_date\n        AND ds.tenant_type = inq.tenant_type\n    LEFT JOIN applications app\n        ON ds.activity_date = app.activity_date\n        AND ds.tenant_type = app.tenant_type\n    LEFT JOIN contracts_signed cs\n        ON ds.activity_date = cs.activity_date\n        AND ds.tenant_type = cs.tenant_type\n    LEFT JOIN confirmed_movein mi\n        ON ds.activity_date = mi.activity_date\n        AND ds.tenant_type = mi.tenant_type\n    LEFT JOIN confirmed_moveout mo\n        ON ds.activity_date = mo.activity_date\n        AND ds.tenant_type = mo.tenant_type\n)\n\nSELECT * FROM final\nORDER BY activity_date DESC, tenant_type", "relation_name": "`gold`.`daily_activity_summary`"}], "elapsed_time": 9.173389196395874, "args": {"print": true, "strict_mode": false, "log_level": "info", "show_resource_report": false, "cache_selected_only": false, "log_format_file": "debug", "enable_legacy_logger": false, "defer": false, "indirect_selection": "eager", "partial_parse": true, "send_anonymous_usage_stats": true, "exclude": [], "version_check": true, "populate_cache": true, "log_file_max_bytes": 10485760, "warn_error_options": {"include": [], "exclude": []}, "project_dir": "/Users/danielkang/tokyobeta-data-consolidation/dbt", "use_colors": true, "use_colors_file": true, "log_format": "default", "quiet": false, "favor_state": false, "write_json": true, "static_parser": true, "partial_parse_file_diff": true, "introspect": true, "vars": {}, "invocation_command": "dbt run --select daily_activity_summary", "log_level_file": "debug", "select": ["daily_activity_summary"], "which": "run", "printer_width": 80, "require_explicit_package_overrides_for_builtin_materializations": false, "log_path": "/Users/danielkang/tokyobeta-data-consolidation/dbt/logs", "macro_debugging": false, "profiles_dir": "/Users/danielkang/tokyobeta-data-consolidation/dbt"}}